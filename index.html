<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
  <title>Cat Pilots Plus</title>
  <script src="./node_modules/cesium/Build/Cesium/Cesium.js"></script>
  <style>
      @import url(./node_modules/cesium/Build/Cesium/Widgets/widgets.css);
      html, body, #cesiumContainer {
          height: 100%; margin: 0; padding: 0; overflow: hidden;
      }
  </style>
</head>
<body>
  <div id="cesiumContainer"></div>
  <script>

    var viewer = new Cesium.Viewer('cesiumContainer');

    var terrainProvider = new Cesium.CesiumTerrainProvider({
        url : '//assets.agi.com/stk-terrain/world'
    });
    viewer.terrainProvider = terrainProvider;

    var scene = viewer.scene;

    var pin;
    var pinBuilder = new Cesium.PinBuilder();
    
    var modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(
        Cesium.Cartesian3.fromDegrees(-75.62898254394531, 40.02804946899414, 1000000));
    var model = scene.primitives.add(Cesium.Model.fromGltf({
        url : './cat-4.gltf',
        modelMatrix : modelMatrix,
        scale : 20000
    }));

    viewer.extend(Cesium.viewerCesiumInspectorMixin);

    function addPin(id, position) {
        viewer.entities.remove(pin)
        pin = viewer.entities.add({
            position: position,
            billboard: {
                image: pinBuilder.fromText(id, Cesium.Color.SALMON, 48),
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                eyeOffset: new Cesium.Cartesian3(0, 0, -1000)
            }
        });
    }

    var handler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);

    handler.setInputAction(function(click) {
        var pickedObject = scene.pick(click.position);
        if (Cesium.defined(pickedObject) && pickedObject.id !== pin) {
            addPin(pickedObject.id.id, scene.camera.pickEllipsoid(click.position));
        } else {
            addPin('G', scene.camera.pickEllipsoid(click.position));
    
            model.modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(
                    scene.camera.pickEllipsoid(click.position))
            var snd = new Audio('sound/cat_screech.wav')
            snd.play()
        }
    }, Cesium.ScreenSpaceEventType.LEFT_CLICK);

  </script>
</body>
</html>